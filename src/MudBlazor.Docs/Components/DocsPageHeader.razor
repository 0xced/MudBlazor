@using Toolbelt.Blazor.HeadElement
@using MudBlazor.Docs.Extensions
@using Microsoft.AspNetCore.Components
@using MudBlazor.Docs.Models

@*html head (for server prerendering)*@
<Title>@GetTitle()</Title>
<Meta Name="description" Content="@SubTitle" />
<Meta Name="keywords" Content="@GetKeywords()"/>
<Meta Property="og:title" Content="@GetTitle()" />
<Meta Name="twitter:title" Content="@GetTitle()" />
@if (!string.IsNullOrEmpty(SubTitle))
{
    <Meta Property="og:description" Content="@SubTitle" />
    <Meta Name="twitter:description" Content="@SubTitle" />
}

<div class="docs-page-header">
    <MudText Typo="Typo.h3">@Title</MudText>
    <MudText>@GetSubTitle() @Description</MudText>
    @if (!IsApiPage && GetComponentTypeName()!=null)
    {
        <MudText Typo="Typo.body2" Class="my-3">See <MudLink Href="@GetApiLink()">@Title API</MudLink> for parameter documentation.</MudText>
    }
    @if (IsApiPage && !string.IsNullOrEmpty(ComponentLink))
    {
        <MudText Typo="Typo.body2">Check out the <MudLink Href="@ComponentLink">Examples</MudLink> for this component.</MudText>
    }        
</div>

@code {


    [Inject] public NavigationManager NavigationManager {get; set;}    

    [Parameter] public string Title { get; set; }
    [Parameter] public string SubTitle { get; set; }
    [Parameter] public string Keywords { get; set; }
    [Parameter] public RenderFragment Description { get; set; }
    [Parameter] public string ComponentLink { get; set; }
    
    [Obsolete("Todo: remove from all pages, then remove here")]
    [Parameter] public string Api { get; set; }
    
    private string GetApiLink() => $"/api/{GetComponentName()}";

    private string GetComponentName()
    {
        return NavigationManager.Uri.ToString().Split('/', StringSplitOptions.RemoveEmptyEntries).LastOrDefault();
    }

    private bool IsApiPage => NavigationManager.Uri.ToString().Contains("/api/");
    
    private string GetComponentTypeName() => ApiLink.GetTypeFromComponentLink( GetComponentName())?.Name;

    string GetTitle() => $"{Title} - MudBlazor";

    string GetSubTitle()
    {
        if (string.IsNullOrEmpty(SubTitle))
            return "";
        return SubTitle.TrimEnd('.') + ".";
    }
    
    string GetKeywords() => $"{Title}, {GetComponentTypeName()}, {Keywords}, mudblazor, blazor, component, material design";
}