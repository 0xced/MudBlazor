@using System.Linq
@using MudBlazor.Docs.Extensions
@inject NavigationManager NavMan
@inject IMenuService _menuService

<MudNavMenu Class="mudblazor-navmenu">
    <div class="docs-nav-fader"></div>
    
    <MudNavGroup Title="Getting Started"
                 Icon="@Icons.Material.School"
                 Expanded="@(_section == "getting-started")"
                 ExpandIcon="@Icons.Material.ExpandMore" Style="margin-top: 40px;">
        <MudNavLink Href="getting-started/installation">Installation</MudNavLink>
        <MudNavLink Href="getting-started/usage">Usage</MudNavLink>
        <MudNavLink Href="getting-started/wireframes">Wireframes</MudNavLink>
    </MudNavGroup>

    @*COMPONENTS*@
    <MudNavGroup Title="Components"
                 Icon="@Icons.Material.Dashboard"
                 Expanded="@(_section == "components")"
                 ExpandIcon="@Icons.Material.ExpandMore">
        @foreach (var item in _menuService.DocsComponents.Elements)
        {
            if (item.IsNavGroup)
            {
                <MudNavGroup Title="@item.Name" Expanded="@(IsSubGroupExpanded(item))" ExpandIcon="@Icons.Material.ExpandMore">
                    @foreach (var subItem in item.GroupItems.Elements) 
                    {
                        string href = $"components/{subItem.Link}";
                        <MudNavLink Href="@href">@subItem.Name</MudNavLink>
                    }
                </MudNavGroup>
            }
            else
            {
                string href = $"components/{item.Link}";
                <MudNavLink Href="@href">@item.Name</MudNavLink>
            }
        }
    </MudNavGroup>
    
    @*API*@
    <MudNavGroup Title="API"
                 Icon="@Icons.Material.Api"
                  Expanded="@(_section == "api")" 
                 ExpandIcon="@Icons.Material.ExpandMore">
        @foreach (var item in _menuService.DocsComponentsApi.Elements)
        {
            <MudNavLink Href="@ApiLink.GetApiLinkFor(item.Component)">@item.Name</MudNavLink>
        }
    </MudNavGroup>

    <MudNavGroup Title="Features"
                 Icon="@Icons.Material.DeveloperBoard" 
                  Expanded="@(_section == "features")"
                 ExpandIcon="@Icons.Material.ExpandMore">
        <MudNavLink Href="features/breakpoints">Breakpoints</MudNavLink>
        <MudNavLink Href="features/border-radius">Border Radius</MudNavLink>
        <MudNavLink Href="features/colors">Colors</MudNavLink>
        <MudNavLink Href="features/converters">Converters</MudNavLink>
        <MudNavLink Href="features/display">Display</MudNavLink>
        <MudNavLink Href="features/elevation">Elevation</MudNavLink>
        <MudNavLink Href="features/flex">Flex</MudNavLink>
        <MudNavLink Href="features/icons">Icons</MudNavLink>
        <MudNavLink Href="features/spacing">Spacing</MudNavLink>
    </MudNavGroup>

    <MudNavGroup Title="Customization"
                 Icon="@Icons.Material.Handyman"
                 Expanded="@(_section == "customization")"
                 ExpandIcon="@Icons.Material.ExpandMore">
        <MudNavLink Href="customization/default-theme">Default Theme</MudNavLink>
        <MudNavGroup Title="Theming" Expanded="true" ExpandIcon="@Icons.Material.ExpandMore">
            <MudNavLink Href="customization/theming/overview">Overview</MudNavLink>
            <MudNavLink Href="customization/theming/palette">Palette</MudNavLink>
            @*<MudNavLink Href="customization/theming/layoutprops">Layout Properties</MudNavLink>
                <MudNavLink Href="customization/theming/shadows">Shadows</MudNavLink>*@
            <MudNavLink Href="customization/theming/z-index">z-index</MudNavLink>
        </MudNavGroup>
    </MudNavGroup>

    <MudNavGroup Title="About" Icon="@Icons.Custom.MudBlazor" Expanded="false" ExpandIcon="@Icons.Material.ExpandMore">
        <MudNavLink Href="project/credit">Credits</MudNavLink>
        <MudNavLink Href="project/about">How it started</MudNavLink>
        <MudNavLink Href="project/team">Team & Contributors</MudNavLink>
        <MudNavLink Href="versions">Versions</MudNavLink>
    </MudNavGroup>
</MudNavMenu>
<div class="docs-nav-filler"></div>

@code {


    //sections are "getting-started","components", "api", ...
    string _section;

    //component links are the part of the url that tells us what component is featured
    string _componentLink;

    public void Refresh()
    {
        _section = NavMan.GetSection();
        _componentLink = NavMan.GetComponentLink();
        StateHasChanged();
    }

        bool IsSubGroupExpanded(MudComponent item)
    {
        #region comment about is subgroup expanded
        //if the route contains any of the links of the subgroup, then the subgroup
        //should be expanded
        //Example:
        //subgroup: form inputs & controls
        //the subgroup "form inputs & controls" should be open if the current page has in the route
        //a component included in the subgroup elements, that in this case are autocomplete, form, field,
        //radio, select...
        //this route `/components/autocomplete` should open the subgroup "form inputs..."
        #endregion
        return item.GroupItems.Elements.Any(i => i.Link ==_componentLink);
    }
}
